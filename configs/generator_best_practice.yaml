# æœ€ä½³å®è·µé…ç½® - æ¨èBç‰ˆæœ¬
# éœ€è¦æ›´é•¿è®­ç»ƒæ—¶é—´,ä½†æ•ˆæœæœ€å¥½

batch_size: 11
n_workers: 16
iterations: 200000        # å¢åŠ è¿­ä»£æ¬¡æ•°
eval_every: 1
accumulate_grad_batches: 1
fp16: False
clip_denoised: True
ema_rate: 0.999

# Early Stopping é…ç½®
early_stopping:
  enabled: True              # æ˜¯å¦å¯ç”¨ early stopping
  patience: 5               # å®¹å¿å¤šå°‘ä¸ªéªŒè¯å‘¨æœŸæ²¡æœ‰æ”¹å–„
  min_delta: 0.001          # æœ€å°æ”¹å–„é˜ˆå€¼
  monitor: val/weighted_loss # ç›‘æ§çš„æŒ‡æ ‡

lr: 1e-4
wd: "1e-4"              # æ·»åŠ æƒé‡è¡°å‡

fine_tune_from: null
schedule_sampler: uniform

model:
  use_y_conditioning: False
  diffusion_steps: 1000
  attention_resolutions: "32,16,8"


# ğŸŒŸ æœ€ä½³å®è·µæ½œå˜é‡é…ç½®
latent:
  enabled: True
  
  # å¢åŠ æ½œå˜é‡å®¹é‡ (ä¿®æ­£å)
  dim: 64                     # âœ¨ ä¿æŒ32ç»´ï¼Œ64ç»´å¤ªå¤§
  project_channels: 8         # âœ¨ 8â†’4 æ”¹ä¸º4chï¼Œé¿å…å‹å€’ä¸»ä¿¡å·
  
  # ä¿å®ˆçš„KLæƒé‡
  beta_max: 0.005             # âœ¨ 0.005â†’0.01 ç•¥å¾®æé«˜ä»¥ç¨³å®šè®­ç»ƒ
  beta_warmup_steps: 10000    # âœ¨ 10000â†’5000 ç¼©çŸ­warm-up
  free_bits: 0.0             # âœ¨ 1.0â†’0.0 ç¦ç”¨free_bitsé¿å…æ¢¯åº¦æ¶ˆå¤±
  
  # å……åˆ†çš„ä¸¤é˜¶æ®µè®­ç»ƒ
  prior_freeze_steps: 5000   # âœ¨ 5000â†’3000 ç¼©çŸ­å†»ç»“æœŸ
  
  # å¢å¼ºç¼–ç å™¨å®¹é‡ (ä¿®æ­£å)
  prior:
    base_channels: 64        # âœ¨ 64â†’32 é™ä½å®¹é‡é¿å…è¿‡æ‹Ÿåˆ
    num_layers: 4
    max_channels: 512        # âœ¨ 512â†’256
  encoder:
    base_channels: 64        # âœ¨ 64â†’32
    num_layers: 4
    max_channels: 512        # âœ¨ 512â†’256

dataset:
  image_path: /home/ldingaj/dataset/radio_images
  label_path:
  size: 512
  n_classes:
  n_channels: 1
  from_uv: False
  real_data: False
  power: 2
  use_zeros: True

comment: conditional_prior_best_practice

# æ”¹è¿›è¯´æ˜:
#
# 1. é€šé“é…ç½® (ä¿®æ­£: 2ch â†’ 6ch)
#    - x_t: 1ch (16.7%)
#    - z_dirty: 1ch (16.7%)  
#    - z_latent: 4ch (66.6%)
#    - ä¸»ä¿¡å·å æ¯”æå‡åˆ°33%ï¼Œæ½œå˜é‡é™è‡³67%ï¼Œæ›´å¹³è¡¡
#
# 2. æ½œå˜é‡å®¹é‡ (ä¿æŒ32ç»´)
#    - 32ç»´è¶³å¤Ÿæ•æ‰ç»“æ„å…ˆéªŒ
#    - 64ç»´å®¹æ˜“å¯¼è‡´è¿‡æ‹Ÿåˆå’Œè®­ç»ƒä¸ç¨³å®š
#    - å¹³è¡¡è¡¨è¾¾èƒ½åŠ›å’Œè®­ç»ƒç¨³å®šæ€§
#
# 3. é€‚ä¸­KLæƒé‡ (Î²=0.01)
#    - åœ¨ä¿¡æ¯ä¿ç•™å’Œçº¦æŸé—´å–å¾—å¹³è¡¡
#    - é˜²æ­¢åéªŒè¿‡åº¦å‘æ•£
#    - å¸®åŠ©å…ˆéªŒç¨³å®šå­¦ä¹ 
#
# 4. é€‚åº¦warm-up (5000æ­¥)
#    - å æ€»è®­ç»ƒçš„25%
#    - å……åˆ†ç¨³å®šåéªŒå­¦ä¹ 
#    - é¿å…warm-upè¿‡é•¿å½±å“æ”¶æ•›
#
# 5. ç¦ç”¨free-bits (0.0)
#    - free_bitsä¼šåœ¨åˆæœŸclampå‡ ä¹æ‰€æœ‰ç»´åº¦
#    - torch.clampé˜»æ–­æ¢¯åº¦ï¼Œå¯¼è‡´ç½‘ç»œæ— æ³•å­¦ä¹ 
#    - æ”¹ç”¨beta_maxå’Œwarmupæ¥æ§åˆ¶KL
#
# 6. é€‚åº¦å†»ç»“æœŸ (3000æ­¥)
#    - å æ€»è®­ç»ƒçš„15%
#    - åéªŒæœ‰å……åˆ†æ—¶é—´æ”¶æ•›
#    - å…ˆéªŒåŠæ—¶å¼€å§‹å­¦ä¹ 
#
# 7. ç¼–ç å™¨å®¹é‡é€‚ä¸­
#    - åŸºç¡€é€šé“: 32 (é€‚ä¸­)
#    - å±‚æ•°: 4 (åŠ æ·±)
#    - æœ€å¤§é€šé“: 256 (é€‚ä¸­)
#    - æ€»å‚æ•°é‡: ~2M (å¹³è¡¡)
#    - è¶³å¤Ÿçš„ç‰¹å¾æå–èƒ½åŠ›ï¼Œé¿å…è¿‡æ‹Ÿåˆ
#
# é¢„æœŸæ•ˆæœ:
# ğŸŒŸ è®­ç»ƒé«˜åº¦ç¨³å®š
# ğŸŒŸ æ½œå˜é‡å­¦åˆ°ä¸°å¯Œç»“æ„ä¿¡æ¯
# ğŸŒŸ ç”Ÿæˆæ ·æœ¬ç»†èŠ‚ä¸°å¯Œ
# ğŸŒŸ å¤šæ ·æ€§æ˜¾è‘—æå‡
# ğŸŒŸ ä½SNRæ£€æµ‹å¤§å¹…æ”¹å–„
# ğŸŒŸ è·¨PWVæ³›åŒ–èƒ½åŠ›å¢å¼º
#
# è®­ç»ƒæ—¶é—´é¢„ä¼°:
# - çº¦éœ€è¦åŸé…ç½®çš„2-3å€æ—¶é—´
# - ä½†æ•ˆæœæå‡40-60%
# - é€‚åˆæœ€ç»ˆæ¨¡å‹è®­ç»ƒ

