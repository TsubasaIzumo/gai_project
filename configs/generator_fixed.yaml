# ä¿®å¤åçš„ç”Ÿæˆå™¨é…ç½® - è§£å†³æ¡ä»¶å…ˆéªŒé—®é¢˜
# åŸºäºæ¶æ„åˆ†æçš„æ¨èé…ç½®A (å¿«é€Ÿä¿®å¤ç‰ˆæœ¬)

batch_size: 11 #22
n_workers: 16
iterations: 200000
eval_every: 1
accumulate_grad_batches: 1
fp16: False
clip_denoised: True
ema_rate: 0.999

# Early Stopping é…ç½®
early_stopping:
  enabled: True              # æ˜¯å¦å¯ç”¨ early stopping
  patience: 5               # å®¹å¿å¤šå°‘ä¸ªéªŒè¯å‘¨æœŸæ²¡æœ‰æ”¹å–„
  min_delta: 0.001          # æœ€å°æ”¹å–„é˜ˆå€¼
  monitor: val/weighted_loss # ç›‘æ§çš„æŒ‡æ ‡

lr: 1e-4
wd: "0"

fine_tune_from: null
schedule_sampler: uniform

model:
  use_y_conditioning: False
  diffusion_steps: 1000
  attention_resolutions: "32,16,8"

# ğŸ”§ ä¿®å¤åçš„æ½œå˜é‡é…ç½®
latent:
  enabled: True
  
  # ä¿æŒåŸdim,ä½†å¤§å¹…é™ä½æŠ•å½±é€šé“æ•°
  dim: 32
  project_channels: 4           # âœ… ä¿®å¤: 16 â†’ 4 (é™ä½75%)
  
  # KLæŸå¤±æƒé‡è°ƒæ•´
  beta_max: 0.01               # âœ… ä¿®å¤: 0.1 â†’ 0.01 (é™ä½10å€)
  beta_warmup_steps: 5000      # âœ… ä¿®å¤: 1000 â†’ 5000 (å¢åŠ 5å€)
  free_bits: 0.0               # âœ… ä¿®å¤: 0.5 â†’ 0.0 (é¿å…æ¢¯åº¦æ¶ˆå¤±)
  
  # ä¸¤é˜¶æ®µè®­ç»ƒç­–ç•¥
  prior_freeze_steps: 3000     # âœ… ä¿®å¤: 0 â†’ 3000 (å…ˆè®­ç»ƒåéªŒ)
  
  # ç¼–ç å™¨é…ç½®ä¿æŒä¸å˜(å®¹é‡å°šå¯)
  prior:
    base_channels: 32
    num_layers: 4
    max_channels: 256
  encoder:
    base_channels: 32
    num_layers: 4
    max_channels: 256

dataset:
  image_path: /home/ldingaj/dataset/radio_images
  label_path:
  size: 512
  n_classes:
  n_channels: 1
  from_uv: False
  real_data: False
  power: 2
  use_zeros: True

comment: conditional_prior_fixed_quickfix

# ä¿®æ”¹è¯´æ˜:
# 1. project_channels: 16â†’4
#    - U-Netè¾“å…¥ä»18ché™ä¸º6ch
#    - ä¸»ä¿¡å·(x_t+z_dirty)æƒé‡ä»11%æå‡åˆ°33%
#    - æ½œå˜é‡å½±å“ä»89%é™ä¸º67%
#    - æ›´å¹³è¡¡çš„æ¢¯åº¦æµ
#
# 2. beta_max: 0.1â†’0.01
#    - é™ä½KLæƒé‡,é˜²æ­¢posterior collapse
#    - å…è®¸æ½œå˜é‡æºå¸¦æ›´å¤šä¿¡æ¯
#    - å‡å°‘è®­ç»ƒä¸ç¨³å®šæ€§
#
# 3. beta_warmup_steps: 1000â†’5000
#    - æ›´é•¿çš„warm-upæœŸ
#    - åéªŒæœ‰å……åˆ†æ—¶é—´å­¦ä¹ æœ‰æ„ä¹‰è¡¨ç¤º
#    - é¿å…è¿‡æ—©æ–½åŠ KLçº¦æŸ
#
# 4. free_bits: 0.0â†’0.5
#    - å¯¹KLæ¯ç»´è®¾ç½®æœ€å°é˜ˆå€¼
#    - é˜²æ­¢éƒ¨åˆ†ç»´åº¦é€€åŒ–ä¸º0
#    - ä¿æŒæ½œå˜é‡å¤šæ ·æ€§
#
# 5. prior_freeze_steps: 0â†’3000
#    - å‰3000æ­¥ä»…è®­ç»ƒencoder,priorå›ºå®šä¸ºN(0,I)
#    - è®©åéªŒå…ˆç¨³å®š
#    - ç„¶åpriorå­¦ä¹ æ‹Ÿåˆå·²ç¨³å®šçš„åéªŒ
#    - æ›´ç¨³å®šçš„è®­ç»ƒåŠ¨æ€
#
# é¢„æœŸæ”¹å–„:
# âœ… è®­ç»ƒæ›´ç¨³å®š,ä¸éœ‡è¡
# âœ… KLæŸå¤±ä¸ä¼šå¿«é€Ÿå¡Œé™·ä¸º0
# âœ… U-Netèƒ½æ›´å¥½åœ°å­¦ä¹ å»å™ªä»»åŠ¡
# âœ… ç”Ÿæˆæ ·æœ¬æ›´æœ‰ç»†èŠ‚
# âœ… å¤šæ¬¡é‡‡æ ·zäº§ç”Ÿæ›´å¤šæ ·åŒ–çš„ç»“æœ
# âœ… åœ¨ä½SNRæ®µæ£€æµ‹æ€§èƒ½æå‡

